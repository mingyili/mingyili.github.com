/*!
 * Last Update : 2016-02-25 04:04:09
 */
function IdCardValidate(a){if(a=trim(a.replace(/ /g,"")),15==a.length)return isValidityBrithBy15IdCard(a);if(18==a.length){var b=a.split("");return isValidityBrithBy18IdCard(a)&&isTrueValidateCodeBy18IdCard(b)?!0:!1}return!1}function isTrueValidateCodeBy18IdCard(a){var b=0;"x"==a[17].toLowerCase()&&(a[17]=10);for(var c=0;17>c;c++)b+=Wi[c]*a[c];return valCodePosition=b%11,a[17]==ValideCode[valCodePosition]?!0:!1}function isValidityBrithBy18IdCard(a){var b=a.substring(6,10),c=a.substring(10,12),d=a.substring(12,14),e=new Date(b,parseFloat(c)-1,parseFloat(d));return e.getFullYear()!=parseFloat(b)||e.getMonth()!=parseFloat(c)-1||e.getDate()!=parseFloat(d)?!1:!0}function isValidityBrithBy15IdCard(a){var b=a.substring(6,8),c=a.substring(8,10),d=a.substring(10,12),e=new Date(b,parseFloat(c)-1,parseFloat(d));return e.getYear()!=parseFloat(b)||e.getMonth()!=parseFloat(c)-1||e.getDate()!=parseFloat(d)?!1:!0}function trim(a){return a.replace(/(^\s*)|(\s*$)/g,"")}function luhmCheck(a){if(a.length<16||a.length>19)return $.toast("银行卡号长度必须在16到19之间","error"),!1;var b=/^\d*$/;if(!b.exec(a))return $.toast("银行卡号必须全为数字","error"),!1;var c="10,18,30,35,37,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,58,60,62,65,68,69,84,87,88,94,95,98,99";if(-1==c.indexOf(a.substring(0,2)))return $.toast("银行卡号开头6位不符合规范","error"),!1;for(var d=a.substr(a.length-1,1),e=a.substr(0,a.length-1),f=new Array,g=e.length-1;g>-1;g--)f.push(e.substr(g,1));for(var h=new Array,i=new Array,j=new Array,k=0;k<f.length;k++)(k+1)%2==1?2*parseInt(f[k])<9?h.push(2*parseInt(f[k])):i.push(2*parseInt(f[k])):j.push(f[k]);for(var l=new Array,m=new Array,n=0;n<i.length;n++)l.push(parseInt(i[n])%10),m.push(parseInt(i[n])/10);for(var o=0,p=0,q=0,r=0,s=0,t=0;t<h.length;t++)o+=parseInt(h[t]);for(var u=0;u<j.length;u++)p+=parseInt(j[u]);for(var v=0;v<l.length;v++)q+=parseInt(l[v]),r+=parseInt(m[v]);s=parseInt(o)+parseInt(p)+parseInt(q)+parseInt(r);var w=parseInt(s)%10==0?10:parseInt(s)%10,x=10-w;return d==x?!0:($.toast("银行卡号输入错误","error"),!1)}function checkpassword(a){var b=/\d+/.test(a),c=/[a-zA-Z]+/.test(a),d=/[\.@#\$%\^&\*\(\)\[\]\\?\\\/\|\-~`\+\=\,\r\n\:\'\"]+/.test(a);return b&&c||b&&d||c&&d?!0:!1}function sendMsgCode(a,b,c){$.showPreloader(),$(".j_send_code").countDown(60),$.ajax({type:"POST",url:API.HTTPS_HOST+"/index.php/licai/conduct/sendverifycode?sid="+API.sid,data:{phone:a,sendcode:1,business:"bindphone",picvalidate:b,state:c},dataType:"json",complete:function(){$.hideIndicator()},success:function(b){1==b.errcode?($.toast(b.errmsg,"error"),$(".j_send_code").stopCountDown(),$(".j_nextstep").stopCountDown()):($(".j_nextstep").countDown(60),$(".j_telphone").html(a),$.router.loadPage("#bindcode"))}})}function checkMobile(a){var b=/^1\d{10}$/;return b.test(a)?!0:!1}!function(a){a.fn.countDown=function(a,b,c){var d=this;if(0==a)d.stopCountDown(c);else{a--,d.clearTimer();var e=setTimeout(function(){d.countDown(a)},1e3);d.data("timer",e),b?b(d):(d.html(a+"s后再发"),d.addClass("disabled"))}},a.fn.stopCountDown=function(a){this.clearTimer(),a?a(this):(this.removeClass("disabled"),this.html("重新发送"))},a.fn.clearTimer=function(){var a=this.data("timer");clearTimeout(a),a=null,this.data("timer",a)}}($);var Wi=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1],ValideCode=[1,0,10,9,8,7,6,5,4,3,2];$(document).on("click",".j_image_summit",function(){var a=$("#validate").val();alert(a),$.ajax({type:"POST",url:API.HTTPS_HOST+"/index.php/licai/conduct/test1?sid="+API.sid,data:{validate:a},dataType:"json",complete:function(){},success:function(a){}})}),$(document).on("click",".j_cash_password",function(){return userinfo.is_phone?userinfo.is_realname||userinfo.is_identity?userinfo.is_password?void $.router.loadPage(userinfo.url_modifypassword):($.router.loadPage(userinfo.url_password),!1):($.modal({text:"请先填写实名信息，再设置提现密码",buttons:[{text:"实名认证",onClick:function(){$.router.loadPage(userinfo.url_identity)}},{text:"取消"}]}),!1):($.modal({text:"请先绑定手机，再设置提现密码",buttons:[{text:"绑定手机",onClick:function(){$.router.loadPage(userinfo.url_phone)}},{text:"取消"}]}),!1)}),$(document).on("click",".j_clear_input",function(){var a=$(this),b=a.prev("input");b.val("").focus()}),$(document).on("click",".j_send_code_password",function(){var a=($(".j_set_pwd").attr("rel"),$(this)),b=a.hasClass("disabled");return b?!1:(b||(a.addClass("disabled"),a.countDown(60)),void $.ajax({type:"POST",url:API.HTTPS_HOST+"/index.php/licai/conduct/sendverifycode?sid="+API.sid,data:{sendcode:2,business:"setcashpassword"},dataType:"json",success:function(a){1==a.errcode&&$.toast(a.errmsg,"error")}}))}),$(document).on("click",".j_bindphone",function(){var a=$(".j_bindphone").attr("rel"),b=$("#bindphonecode").val(),c=$("#bindcellphone").val();return checkMobile(c)?""==b?($.toast("验证码为空","error"),!1):($(".button-fill").removeClass("j_bindphone"),void $.ajax({type:"POST",url:API.HTTPS_HOST+"/index.php/licai/conduct/savephone?sid="+API.sid,data:{code:b,phone:c,type:a},dataType:"json",complete:function(){$(".button-fill").addClass("j_bindphone")},success:function(a){if(0==a.errcode){if(0==a.type)return $.router.loadPage(a.url),!1;$.modal({text:a.tittle,buttons:[{text:a.errmsg,onClick:function(){$.router.loadPage(a.url)}},{text:"取消"}]})}else $.toast(a.errmsg,"error")}})):($.toast("手机号不合法","error"),!1)}),$(document).on("click",".j_nextstep",function(){var a=$(this),b=a.hasClass("disabled");if(b)return!1;var c=$("#bindcellphone").val();if(!checkMobile(c))return $.toast("手机号不合法","error"),!1;var d=$("#imgcode").val();return d?void sendMsgCode(c,d,1):($.toast("验证码不能为空","error"),!1)}),$(document).on("click",".j_send_code",function(){var a=$(this),b=a.hasClass("disabled");if(b)return!1;var c=$("#bindcellphone").val();sendMsgCode(c)}),$(document).on("click",".j_identity",function(){var a=$(".j_identity").attr("rel"),b=$("#conductname").val(),c=$("#conductidentity").val();return""==b?($.toast("姓名不能为空","error"),!1):IdCardValidate(c)?($(".button-fill").removeClass("j_identity"),void $.ajax({type:"POST",url:API.HTTPS_HOST+"/index.php/licai/conduct/saveidentity?sid="+API.sid,data:{name:b,identity:c,type:a},dataType:"json",complete:function(){$(".button-fill").addClass("j_identity")},success:function(a){if(0==a.errcode){if(4==a.type||0==a.type)return $.router.loadPage(a.url),!1;$.modal({text:a.tittle,buttons:[{text:a.errmsg,onClick:function(){$.router.loadPage(a.url)}},{text:"取消"}]})}else $.toast(a.errmsg,"error")}})):($.toast("身份证号码不合法","error"),!1)}),$(document).on("click",".j_modify_password",function(){var a=$("#oldpassword").val(),b=$("#newpassword").val(),c=$("#confirmnewpassword").val();return""==a?($.toast("原始密码不能为空","error"),!1):""==b?($.toast("密码不能为空","error"),!1):""==c?($.toast("确认密码不能为空","error"),!1):checkpassword(b)&&checkpassword(c)?b!=c?($.toast("两次密码不一致","error"),!1):($(".button-fill").removeClass("j_modify_password"),void $.ajax({type:"POST",url:API.HTTPS_HOST+"/index.php/licai/conduct/modifypassword?sid="+API.sid,data:{oldpassword:a,newpassword:b,confirmnewpassword:c},dataType:"json",complete:function(){$(".button-fill").addClass("j_modify_password")},success:function(a){if(0==a.errcode)$.alert(a.title,a.errmsg,function(){$.router.reloadPage(a.url,!0)});else if(1==a.errcode)$.toast(a.errmsg,"error");else if(2==a.errcode)return $.modal({text:a.tittle,buttons:[{text:a.errmsg,onClick:function(){$.router.loadPage(a.url)}},{text:"取消"}]}),!1}})):($.toast("密码为8-16位字符数字、字母、特殊字符，起码其中两种组合","error"),!1)}),$(document).on("click",".j_oldpwd_confirm",function(){$.router.reloadPage(API.HTTPS_HOST+"/index.php/weixin/activity/licai?link=setpwd?sid="+API.sid)}),$(document).on("click",".j_set_pwd",function(){var a=$(".j_set_pwd").attr("rel"),b=$("#vcodepassword").val(),c=$("#password").val(),d=$("#confirmpassword").val();return""==b?($.toast("验证码不能为空","error"),!1):""==c?($.toast("密码不能为空","error"),!1):""==d?($.toast("确认密码不能为空","error"),!1):checkpassword(c)&&checkpassword(d)?($(".button-fill").removeClass("j_set_pwd"),void $.ajax({type:"POST",url:API.HTTPS_HOST+"/index.php/licai/conduct/savepassword?sid="+API.sid,data:{code:b,password:c,confirmpassword:d,type:a},dataType:"json",complete:function(){$(".button-fill").addClass("j_set_pwd")},success:function(a){0==a.errcode?$.alert(a.tittle,a.errmsg,function(){$.router.reloadPage(a.url,!0)}):$.alert(a.tittle,a.errmsg,function(){})}})):($.toast("密码为8-16位字符数字、字母、特殊字符，起码其中两种组合","error"),!1)}),$(document).on("pageInit","#coupon",function(a,b,c){}),$(document).on("click",".j_bind_card",function(){return userinfo.is_identity?void(userinfo.is_bindcard?$.router.loadPage(userinfo.url_bankcards):$.router.loadPage(userinfo.url_bindcard)):($.modal({text:"请先填写实名信息，再进行添加银行卡",buttons:[{text:"实名认证",onClick:function(){$.router.loadPage(API.HTTPS_HOST+"/index.php/licai/conduct/identity?sid="+API.sid+"&type=5")}},{text:"取消"}]}),!1)}),$(document).on("click",".j-selectbank",function(){var a=$(this);newhtml=a.html(),$("#J_bank_tag").html(newhtml),$.closeModal(".selectbank")}),$(document).on("click",".j_bindcard",function(){var a=$(".j_bindcard").attr("rel"),b=$("#bankcardno").val();return""==b?($.toast("银行卡为空","error"),!1):void(luhmCheck(b)&&($(".j_remove_bindcard").removeClass("j_bindcard"),$.showPreloader(),$.ajax({type:"POST",url:API.HTTPS_HOST+"/index.php/licai/conduct/savecard?sid="+API.sid,data:{card_no:b,type:a},dataType:"json",complete:function(){$(".j_remove_bindcard").addClass("j_bindcard"),$.hideIndicator()},success:function(a){return $(".button-fill").addClass("j_bindcard"),0!=a.errcode?($.toast(a.errmsg,"error"),!1):void $.router.reloadPage(a.url)}})))}),$(document).on("click",".j_card_action",function(){var a=[{text:"解除绑定",color:"danger",onClick:function(){var a='<div style="margin: .8rem 0;">请输入身份认证号</div>';$.modalPassword(a,"请输入身份证号",function(a){$.toast("解绑成功！",1e3,"success")})}}],b=[{text:"取消"}],c=[a,b];$.actions(c)});